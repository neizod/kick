
(function(){var ShootingWord,WordKeeper,animate,boss,fps,inventory,player,pool,stage_height,stage_width,tutorial,tweet,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key];}function ctor(){this.constructor=child;}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child;},__bind=function(fn,me){return function(){return fn.apply(me,arguments);};},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i;}return-1;};Array.prototype.pop=function(index){if(index==null){index=this.length-1;}
return this.splice(index,1)[0];};Array.prototype.random=function(){return this[Math.floor(this.length*Math.random())];};$.prototype.css_center=function(max_width){return this.css('left',(max_width-this.width())/2);};$.prototype.clear_pos=function(){return this.css('left','')&&this.css('top','');};stage_height=300;stage_width=1000;tweet=function(text){var url;url='http://neizod.github.io/kick';$('#tweet').html($('<a>').addClass('twitter-share-button').html('tweet').attr('href','https://twitter.com/share').attr('data-text',text).attr('data-url',url).attr('data-lang','en').attr('data-count','vertical').attr('data-counturl',url));return typeof twttr!=="undefined"&&twttr!==null?twttr.widgets.load():void 0;};ShootingWord=(function(){function ShootingWord(full){this.full=full;this.remain=this.full;this.speed=110;if(player.lvl<10){this.speed+=player.lvl*(25-player.lvl)/2;}else{this.speed+=player.lvl*4+36;}
this.repr=$('<div>').addClass('absolute');this.update();$('#placeholder').html(this.repr);this.top=(stage_height-this.repr.height())*Math.random();this.left=stage_width-this.repr.width();this.repr.css('top',this.top).css('left',this.left);$('#placeholder').empty();}
ShootingWord.prototype.done=function(){return this.full.slice(0,this.full.length-this.remain.length);};ShootingWord.prototype.shot=function(c){if(c===this.remain[0]){this.remain=this.remain.slice(1);}
return this.update();};ShootingWord.prototype.move=function(){this.left-=this.speed/fps.rate();return this.repr.css('left',this.left);};ShootingWord.prototype.update=function(){if(this.remain===this.full){return this.repr.html($('<b>').html(this.full));}else{return this.repr.html([$('<u>').html(this.done()),$('<b>').html(this.remain)]);}};ShootingWord.prototype.reset=function(){this.remain=this.full;return this.update();};return ShootingWord;})();fps=new((function(){function _Class(){this.frames=60;this.actual=0;this.time=0;this.date=new Date();}
_Class.prototype.loop=function(){var now;if(this.actual!==this.frames){this.actual+=1;}
now=new Date();this.time+=(now-this.date-this.time)/this.actual;return this.date=now;};_Class.prototype.rate=function(){return 1000/this.time;};_Class.prototype.show=function(){return this.rate().toFixed(1)+' fps';};return _Class;})());boss=new((function(){function _Class(){this.status='normal';}
_Class.prototype.reset=function(){this.constructor();return $('#boss').attr('class','absolute').addClass(this.status);};_Class.prototype.sleep=function(){return $('#boss').removeClass(this.status).addClass('sleep');};_Class.prototype.awake=function(){return $('#boss').removeClass('sleep').addClass(this.status);};_Class.prototype.update=function(lvl){if(lvl==null){lvl=player.lvl;}
$('#boss').removeClass(this.status);if(lvl>7){this.status='tear';}else{this.status=['love','normal','ennui','curious','exclaim','angry','wtf','wth'][lvl];}
return $('#boss').addClass(this.status);};return _Class;})());player=new((function(){function _Class(){this.lvl=1;this.lives=3;this.score=0;this.die=false;this.word=null;this.pair=null;this.longest=[];}
_Class.prototype.reset=function(){var _ref,_ref1;if((_ref=this.word)!=null){_ref.reset();}
this.word=null;if((_ref1=this.pair)!=null){_ref1.reset();}
return this.pair=null;};_Class.prototype.shoot=function(c){var _ref,_ref1,_ref2,_ref3;((_ref=this.word)!=null?_ref.shot(c):void 0)&&((_ref1=this.pair)!=null?_ref1.shot(c):void 0);if(((_ref2=this.word)!=null?_ref2.remain:void 0)===''){pool.remove(this.word);if(this.word.full===((_ref3=inventory.name)!=null?_ref3.full:void 0)){this.score+=inventory.scoring();inventory.clear();}else if(!(this.pair!=null)){this.score+=1;inventory.add(this.word);}else{inventory.remove(this.word);}
if(this.lvl<Math.floor(Math.log(Math.E+this.score))){this.lvl+=1;this.lives+=1;boss.update();}
pool.autofill();this.word=null;return this.pair=null;}};_Class.prototype.show_lives=function(){if(this.lives>3){return'lives: ♥×'+this.lives;}else if(this.lives>0){return'lives: '+((function(){var _i,_ref,_results;_results=[];for(_i=0,_ref=Math.max(this.lives,0);0<=_ref?_i<_ref:_i>_ref;0<=_ref?_i++:_i--){_results.push('♥');}
return _results;}).call(this)).join('');}else{return'lives: ☠';}};_Class.prototype.show_lvl=function(){return'level: '+this.lvl;};_Class.prototype.show_score=function(){return'score: '+this.score;};_Class.prototype.make_summary=function(){this.make_tweet();return $('#summary').html("<p>game over, your score is <u>"+this.score+"</u>.</p>").append('<p>click below to tweet your score!</p>').show();};_Class.prototype.make_tweet=function(){var quota,score,sentence,url_preserve_length,word,_i,_len,_ref;if(!this.longest.length){return tweet('i got kicked by @neizod.');}
url_preserve_length=23;score=" @neizod and score "+this.score+"!";quota=140-url_preserve_length-score.length;sentence='i';_ref=this.longest;for(_i=0,_len=_ref.length;_i<_len;_i++){word=_ref[_i];if(sentence.length+1+word.full.length>=quota){break;}
sentence+=' '+word.full;}
return tweet(sentence+score);};return _Class;})());WordKeeper=(function(){function WordKeeper(){}
WordKeeper.prototype.get=function(str){var comparator,i,word,_i,_len,_ref;_ref=this.words;for(i=_i=0,_len=_ref.length;_i<_len;i=++_i){word=_ref[i];comparator=str.length===1?word.remain[0]:word.full;if(str===comparator){return this.words[i];}}};WordKeeper.prototype.remove=function(word){var index;if((index=this.index(word))!=null){return this.words.pop(index);}};WordKeeper.prototype.index=function(find){var i,word,_i,_len,_ref;_ref=this.words;for(i=_i=0,_len=_ref.length;_i<_len;i=++_i){word=_ref[i];if(word.full===find.full){return i;}}};return WordKeeper;})();pool=new((function(_super){__extends(_Class,_super);function _Class(){this.words=[];}
_Class.prototype.actions=null;_Class.prototype.add=function(word){if(word==null){word=this.actions.random();}
return this.words.push(new ShootingWord(word));};_Class.prototype.autofill=function(){var _i,_ref,_results;_results=[];for(_i=0,_ref=Math.max(player.lvl-this.words.length,0);0<=_ref?_i<_ref:_i>_ref;0<=_ref?_i++:_i--){_results.push(this.add());}
return _results;};_Class.prototype.loop=function(){var word,_i,_len,_ref,_results;_ref=this.words;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){word=_ref[_i];_results.push(word.move());}
return _results;};_Class.prototype.attack=function(){return(this.words.filter(function(word){return word.left<=0;})).length;};_Class.prototype.clean=function(){var _ref,_ref1;if(((_ref=player.word)!=null?_ref.left:void 0)<=0){player.word=null;if((_ref1=player.pair)!=null){_ref1.reset();}}
return this.words=this.words.filter(function(word){return word.left>0;});};_Class.prototype.easter_egg=function(force){if(force==null){force=false;}
if(animate.id===1||force){this.words=[];return this.add('kick');}};return _Class;})(WordKeeper));inventory=new((function(_super){__extends(_Class,_super);function _Class(){this.words=[];this.name=null;}
_Class.prototype.add=function(word){word.reset();this.words.push(word);if(!(this.name!=null)){return this.name=new ShootingWord('@neizod');}};_Class.prototype.remove=function(word){_Class.__super__.remove.apply(this,arguments);if(!this.words.length){return this.name=null;}};_Class.prototype.get_name=function(c){var _ref;if(c===((_ref=this.name)!=null?_ref.remain[0]:void 0)){return this.name;}};_Class.prototype.scoring=function(){var i,score,word,_i,_len,_ref;score=0;_ref=this.words;for(i=_i=0,_len=_ref.length;_i<_len;i=++_i){word=_ref[i];score+=word.full.length*Math.max(player.lvl-i,1);}
return score;};_Class.prototype.clear=function(){if(this.words.length>=player.longest.length){player.longest=this.words;}
this.name=null;return this.words=[];};_Class.prototype.show=function(){var sentence,word;sentence=this.words.concat(this.name!=null?[this.name]:[]);return((function(){var _i,_len,_results;_results=[];for(_i=0,_len=sentence.length;_i<_len;_i++){word=sentence[_i];_results.push(word.repr.html());}
return _results;})()).join(' ');};return _Class;})(WordKeeper));animate=new((function(){function _Class(){this.loop=__bind(this.loop,this);this.id=null;}
_Class.prototype.start=function(){fps.constructor();pool.autofill();this.id=setInterval(this.loop,7);return this.toggle_tools();};_Class.prototype.pause=function(){this.id=clearInterval(this.id);return this.toggle_tools();};_Class.prototype.stop=function(){return this.pause();};_Class.prototype.reset=function(){var reinit_object,_i,_len,_ref,_results;_ref=[player,inventory,pool];_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){reinit_object=_ref[_i];_results.push(reinit_object.constructor());}
return _results;};_Class.prototype.alive=function(){return $('#playground').removeClass('dead').addClass('alive');};_Class.prototype.dead=function(){return $('#playground').removeClass('alive').addClass('dead');};_Class.prototype.loop=function(){var damage,word;fps.loop();pool.loop();$('#score').html(player.show_score());$('#lvl').html(player.show_lvl());$('#keep').html(inventory.show()).css_center(stage_width);$('#fps').html(fps.show());$('#playground').html((function(){var _i,_len,_ref,_results;_ref=pool.words;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){word=_ref[_i];_results.push(word.repr);}
return _results;})());if((damage=pool.attack())){player.lives-=damage;pool.clean();pool.autofill();}
$('#lives').html(player.show_lives());if(player.lives<=0){if(player.score===0){boss.update(0);}
player.make_summary();this.stop();this.reset();this.toggle_tools();this.dead();$('#start').html('play again!');return $('#menu').show().css_center(stage_width);}};_Class.prototype.toggle_tools=function(){if(animate.id){$('#pause').show();$('#resume').hide();return $('#erase').prop('disabled',false);}else{$('#pause').hide();$('#resume').show();return $('#erase').prop('disabled',true);}};return _Class;})());tutorial=new((function(){function _Class(){this.step=0;this.all_steps=4;}
_Class.prototype.reset=function(){while(this.step){this.nextstep();}
return this.sample[0]();};_Class.prototype.sample={0:function(){animate.reset();$('#score').html(player.show_score());$('#lvl').html(player.show_lvl());return $('#lives').html(player.show_lives());},1:function(){pool.easter_egg(true);player.word=pool.words[0];player.word.repr.clear_pos().attr('id','sample-1');return $('#playground').html(player.word.repr);},2:function(){player.word.remain=player.word.full.slice(2);player.word.update();player.word.repr.clear_pos().attr('id','sample-2');return $('#playground').html(player.word.repr);},3:function(){player.word.remain='';player.shoot();player.word=inventory.name;player.word.remain=player.word.full.slice(4);player.word.update();$('#playground').empty();return $('#keep').html(inventory.show()).css_center(stage_width);},4:function(){player.word.remain='';player.shoot();$('#keep').empty();$('#score').html(player.show_score());return $('#lvl').html(player.show_lvl());}};_Class.prototype.nextstep=function(){if(this.step){$("#step-"+this.step).hide();}else{$('#howto').hide();$('#start').hide();$('.social').hide();$('#nextstep').show();$('#tutorial').show();animate.alive();}
this.step+=1;this.step%=this.all_steps+1;if(this.step){$("#step-"+this.step).show();if(this.step===this.all_steps){$('#start').show();$('#howto').show();$('.social').show();$('#nextstep').hide();}}else{$('#howto').show();$('#nextstep').hide();$('#tutorial').hide();}
return this.sample[this.step]();};return _Class;})());$(document).keydown(function(event){var button,clickable_button,hotkeys,id,keys,_ref;hotkeys={nextstep:[13,27],howto:[27],erase:[8,46],pause:[27],start:[13],resume:[13,27]};for(id in hotkeys){keys=hotkeys[id];button=$("#"+id);clickable_button=button.is(':visible')&&!button.is(':disabled');if(clickable_button&&(_ref=event.keyCode,__indexOf.call(keys,_ref)>=0)){return button.click();}}});$(document).keypress(function(event){var c;if(!(animate.id!=null)){return;}
c=String.fromCharCode(event.charCode);if(!(player.word!=null)){player.word=pool.get(c);}
if(player.word!=null){if(player.word.full===player.word.remain){player.pair=inventory.get(player.word.full);}}else{player.word=inventory.get_name(c);}
return player.shoot(c);});$(document).ready(function(){var pre_hidden,_i,_len,_ref;animate.toggle_tools();_ref=['#nextstep','#tutorial','#summary'];for(_i=0,_len=_ref.length;_i<_len;_i++){pre_hidden=_ref[_i];$(pre_hidden).hide();}
animate.alive();boss.reset();$('#menu').show().css_center(stage_width);$.get('words.txt',function(data){return pool.actions=data.split('\n').filter(function(word){return word.length;});});$('#start').click(function(){tutorial.reset();boss.reset();return $('#summary').hide();});$('#start, #resume').click(function(){if(!pool.actions){return $('#keep').html('-- file not ready, please try again. --').css_center(stage_width);}
animate.start();boss.awake();pool.easter_egg();$('#menu').hide();return animate.alive();});$('#howto').click(function(){tutorial.reset();boss.reset();return $('#summary').hide();});$('#howto, #nextstep').click(function(){tutorial.nextstep();return $('#menu').show().css_center(stage_width);});$('#erase').click(function(){return player.reset();});$('#pause').click(function(){animate.pause();boss.sleep();$('#playground').empty();return $('#keep').html('-- game pause --').css_center(stage_width);});return tweet("let's play kick @neizod!");});}).call(this);
